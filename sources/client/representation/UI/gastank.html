<!doctype html>
<html>
<head>
<meta charset="utf-8"/>
<title>Gas Tank's Panel</title>
<link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
<style>
body
{
	margin: 10px;
}
</style>
<script src="qwebchannel.js"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
<script>
var script_status = {"valve_status": undefined, "pressure": undefined};

function UpdateScript()
{
	UpdatePressure();
	UpdateButton();
}
function UpdatePressure()
{
	holder.syncScriptStatus();
	$("#pressure").html(script_status["pressure"]);
}
function UpdateButton()
{
	var inner = ["Closed", "Opened"];
	var status = script_status["valve_status"];
	$("#togglevalve").html(inner[status]);

	if (status == 0)
	{
		$("#togglevalve").removeClass("w3-green");
		$("#togglevalve").addClass("w3-red");
	}
	else
	{
		$("#togglevalve").removeClass("w3-red");
		$("#togglevalve").addClass("w3-green");
	}
}

window.onload = function()
{
	new QWebChannel(qt.webChannelTransport, function (channel) {
		window.holder = channel.objects.holder;
		
		holder.syncScriptStatus();
		setTimeout(UpdateData, 0); // call UpdateData at same moment with syncScriptStatus, doesn't update data properly
								   // I suppose it can be that holder.syncScriptStatus() asynchronously execute 
								   // and it just doesn't have time to update script_status
		
		$("#togglevalve").click( function()
		{
			holder.toggleValve();
			holder.syncScriptStatus();

			UpdateButton();
		});
	});
}
</script>
</head>
<body>
<p>Valve Status: <button id="togglevalve" class="w3-button w3-padding-small">none</button></p>
<p>Pressure: <span id="pressure">0.0</span> kPa</p>
</body>
</html>
