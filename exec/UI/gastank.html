<!doctype html>
<html>
<head>
<meta charset="utf-8"/>
<title>Gas Tank's Panel</title>
<link rel="stylesheet" href="css/w3.css">
<link rel="stylesheet" href="css/global.css">
<script type="text/javascript" src="js/vue.js"></script>
<script type="text/javascript" src="qrc:///qtwebchannel/qwebchannel.js"></script> <!-- Only for clients run inside Qt WebEngine !-->
</head>
<body>
<p id="togglevalve">Valve Status:
<button class="w3-button w3-padding-small w3-red" v-on:click="onToggleValve" v-if="status">Closed</button>
<button class="w3-button w3-padding-small w3-green" v-on:click="onToggleValve" v-else>Opened</button>
</p>
<p id="temperature">Temperature: {{ status }}</p>
<p id="pressure">Pressure: {{ status }}</p>
<script>
document.addEventListener("DOMContentLoaded", function () {
    if(typeof qt === 'undefined')
    {
        alert("Only for clients run inside Qt WebEngine");
        console.error("Only for clients run inside Qt WebEngine");
    }

    new QWebChannel(qt.webChannelTransport, function(channel){
        window.cppSide = channel.objects.GasTankUI;

        window.cppSide.UpdateData.connect(function(pressure, temperature, valve_status) {
            v_togglevalve.status = valve_status;
            v_pressure.status = pressure;
            v_temperature.status = temperature;
        });
    });
});

var v_togglevalve = new Vue({
  el: '#togglevalve',
  data: {
    status: false
  },
  methods: {
        onToggleValve: function(){
            this.status = !this.status;

            cppSide.ChangeValveStatus(this.status, function(r){});
        }
    }
})

var v_pressure = new Vue({
  el: '#pressure',
  data: {
    status: 0.0
  }
})

var v_temperature = new Vue({
  el: '#temperature',
  data: {
    status: 0.0
  }
})
</script>
</body>
</html>
