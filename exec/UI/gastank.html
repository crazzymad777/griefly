<!doctype html>
<html>
<head>
<meta charset="utf-8"/>
<title>Gas Tank's Panel</title>
<link rel="stylesheet" href="css/w3.css">
<link rel="stylesheet" href="css/global.css">
<script type="text/javascript" src="js/vue.js"></script>
<script type="text/javascript" src="qrc:///qtwebchannel/qwebchannel.js"></script> <!-- Only for clients run inside Qt WebEngine !-->
</head>
<body>
<p id="togglevalve">Valve Status:
<button class="w3-button w3-padding-small w3-red" v-on:click="onToggleValve"   v-if="status == GASTANK_STATE_CLOSED">Closed</button>
<button class="w3-button w3-padding-small w3-green" v-on:click="onToggleValve" v-else-if="status == GASTANK_STATE_OPEN">Opened</button>
<button class="w3-button w3-padding-small w3-gray" v-on:click="onToggleValve"  v-else>Broken</button>
</p>
<p id="temperature">Temperature: {{ status }}</p>
<p id="pressure">Pressure: {{ status }}</p>
<script>
const GASTANK_STATE_OPEN = 0;
const GASTANK_STATE_CLOSED = 1;
const GASTANK_STATE_BROKEN = 2;

document.addEventListener("DOMContentLoaded", function () {
    if(typeof qt === 'undefined')
    {
        alert("Only for clients run inside Qt WebEngine");
        console.error("Only for clients run inside Qt WebEngine");
        return;
    }

    new QWebChannel(qt.webChannelTransport, function(channel){
        window.cppSide = channel.objects.GasTankUI;

        window.cppSide.UpdateData.connect(function(pressure, temperature, state) {
            v_valve.status = state;
            v_pressure.status = pressure;
            v_temperature.status = temperature;
        });
    });
});

var v_valve = new Vue({
  el: '#togglevalve',
  data: {
    GASTANK_STATE_OPEN: GASTANK_STATE_OPEN,
    GASTANK_STATE_CLOSED: GASTANK_STATE_CLOSED,
    GASTANK_STATE_BROKEN: GASTANK_STATE_BROKEN,
    status: 0
  },
  methods: {
        onToggleValve: function(){
            if(this.status == GASTANK_STATE_OPEN)
            {
                this.status = GASTANK_STATE_CLOSED;
            }
            else if(this.status == GASTANK_STATE_CLOSED)
            {
                this.status = GASTANK_STATE_OPEN;
            }
            else
            {
                return;
            }

            cppSide.ChangeValveStatus(this.status);
        }
    }
})

var v_pressure = new Vue({
  el: '#pressure',
  data: {
    status: 0.0
  }
})

var v_temperature = new Vue({
  el: '#temperature',
  data: {
    status: 0.0
  }
})
</script>
</body>
</html>
